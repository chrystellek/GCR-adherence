---
title: "results"
format: docx
editor: visual
---

## Adherence during a pandemic

Chrystelle Kiang Dissertation Aim

### Note space

Here goes my attempt at using quarto for some of this dissertation aim text. This first section is just a note space and then the actual body comes later

First, want to get descriptive statistics. I am importing the dataset created in data_creation.R for now, which is NOT subset by medication type since I will want to include information about who we will exclude.

```{r}
#| include: false
library(here) 
library(tidyverse)
library(gtsummary)
library(ggplot2)

# this is all prescriptions for eligible study population
pharmstudydata <- readRDS("studypopdata.rds")
#TODO will need to subset further to actual analytic dataset
#TODO drop repeat variables here? 

# subset to drugs of interest
studydata <- pharmstudydata %>%
  filter(drug_group %in% c("AI","TAMOXIFEN"))

```

### Study Population

Details about study population and prescription information go here.

```{r}
# one line per patient
studypop <- studydata %>%
  distinct(StudyID, .keep_all = TRUE)

n_studypop <- n_distinct(studydata$StudyID)

table1 <- studypop %>%
  tbl_summary(include = c(PATIENTRACE_1, PATIENTNHIA, CTCMARITAL_STATUS_AT_DX, CTCAGE_AT_DIAGNOSIS, CTCDATE_OF_DIAGNOSIS_YYYY, CTCLATERALITY, CTCGRADE, ERstatus))
```

### Results

There are `n_studypop` patients who had ER positive tumors, diagnosed stages I to III, and had any prescription starting on January 1, 2018.

#### Descriptive prescription information

```{r}
# want to look at prescriptions per person
# only keep one drug per patient
drugsbystudyID <- studydata %>%
  group_by(StudyID) %>%
  summarise(unique_drug_type = n_distinct(drug_group))

studyIDs_multiple_drugs <- drugsbystudyID %>%
  filter(unique_drug_type > 1) 

studydata_multiple_drugs <- studydata %>%
  inner_join(studyIDs_multiple_drugs, by = "StudyID")

# studydata is subset to AI and TAM only
ggplot(studydata, aes(x = dispense_dt, y = PersonID, group = PersonID, color = drug_name)) +
  geom_point() + geom_line() + theme_classic()

ggplot(studydata, aes(x = dispense_dt, y = PersonID, group = PersonID, color = drug_group)) +
  geom_point() + geom_line() + facet_wrap(vars(CTCRX_SUMM_DT_SURGERY_YYYY)) +
   labs(title = "all patients") + theme_classic()

# subset of patients with BOTH AI and TAM
ggplot(studydata_multiple_drugs, aes(x = dispense_dt, y = PersonID, group = PersonID, color = drug_group)) + geom_point() + geom_line() + 
  labs(title = "patients with both AI and TAM") + theme_classic()
```

-   Plot of prescriptions over time (separate from ITS)
